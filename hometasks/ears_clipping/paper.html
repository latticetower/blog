<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>paper with polygon</title>
    <!--link rel="stylesheet" href="../css/style.css"-->
    <script type="text/javascript" src="dist/paper-full.js"></script>
    <script type="text/javascript" src="papered_polygon.js"></script>
    <script type="text/paperscript" canvas="canvas">
        //var path;
        var poly = new CompoundPath({strokeColor: 'blue'});
        var path = new Path({
          strokeColor: 'grey',
        });
        //poly.addChild(path);

        var points = [];

        function joinPath() {
          path.closePath(true);
          points = [];
          for (var i = 0; i < path.segments.length; i ++) {
            points.push({'index' : i, 'next': 0, 'prev': 0});
            if (i > 0) {
              points[i]['prev'] = i - 1;
              points[i - 1]['next'] = i;
            }
          }
          if (points.length > 0)
            points[0]['prev'] = points.length - 1;
          /*for (var i = 0; i < points.length; i++) {
            console.log(points[i]);
          }*/
        }

        var textItem = new PointText({
            content: 'Click and drag to draw a polygon.',
            point: new Point(20, 30),
            fillColor: 'black',
        });
        var joinPolyTextItem = new PointText({
          content: 'join poly',
          point :new Point(20, 40),
          fillColor: 'red',
          onMouseEnter: function(event) {
            joinPath();
          }
        });


        var clearPolyTextItem = new PointText({
          content: 'clear poly',
          point :new Point(20, 60),
          fillColor: 'red',
          onMouseEnter: function(event) {
            points = [];
            path.removeSegments();
            poly.removeChildren();
          }
        });

        var triangulatePolyTextItem = new PointText({
          content: 'triangulate poly',
          point :new Point(20, 80),
          fillColor: 'red',
          onMouseEnter: function(event) {
            var earclipper = new EarClipper(path.segments, points);
            showEars(earclipper.getEars(), points, path);
          }
        });

        function showEars(ears, points, path) {
          console.log("ear vertex indices: ", ears);
          for (var i = 0; i < ears.length - 1; i ++) {
            //console.log(points[ears[i]]);
            index1 = points[ears[i]]['prev'];
            index2 = points[ears[i]]['next'];
            poly.addChild(
              new Path.Line(path.segments[index1].point, path.segments[index2].point
            ));
          }
        }

        function onMouseDown(event) {
            path.add(event.point);
            //p = new Point(event.point);
            poly.addChild(new Path.Circle({
              center: event.point,
              radius: 3,
              fillColor: 'blue'
              })
            );
        }
    </script>
</head>
<body>
    <canvas id="canvas" resize></canvas>
</body>
</html>
